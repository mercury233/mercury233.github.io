<!DOCTYPE html><html lang="zh-CN"><meta charset="UTF-8"><title>笔记：在Windows下编译YGOPro | Mercury233</title><meta content="width=device-width,initial-scale=1,user-scalable=no" name="viewport"><meta content="Mercury233" name="author"><meta content="近期在 MyCard 项目中尝试了自动化编译 YGOPro，发现官方采用 premake 生成项目文件，但并没有给出具体方法。故在此记录下折腾的成果。本笔记基本上是参考了 DailyShana 的 build 分支写成，感谢 soarqin 和 DailyShana 的工作。本笔记的操作在 Windows 7 和 Visual Studio Community 2015 上测试通过，理论上也可以适" name="description"><meta content="article" property="og:type"><meta content="笔记：在Windows下编译YGOPro" property="og:title"><meta content="http://mercury233.me/2016/09/22/笔记：在Windows下编译YGOPRO/index.html" property="og:url"><meta content="Mercury233" property="og:site_name"><meta content="近期在 MyCard 项目中尝试了自动化编译 YGOPro，发现官方采用 premake 生成项目文件，但并没有给出具体方法。故在此记录下折腾的成果。本笔记基本上是参考了 DailyShana 的 build 分支写成，感谢 soarqin 和 DailyShana 的工作。本笔记的操作在 Windows 7 和 Visual Studio Community 2015 上测试通过，理论上也可以适" property="og:description"><meta content="2017-03-13T10:19:32.853Z" property="og:updated_time"><meta content="summary" name="twitter:card"><meta content="笔记：在Windows下编译YGOPro" name="twitter:title"><meta content="近期在 MyCard 项目中尝试了自动化编译 YGOPro，发现官方采用 premake 生成项目文件，但并没有给出具体方法。故在此记录下折腾的成果。本笔记基本上是参考了 DailyShana 的 build 分支写成，感谢 soarqin 和 DailyShana 的工作。本笔记的操作在 Windows 7 和 Visual Studio Community 2015 上测试通过，理论上也可以适" name="twitter:description"><link href="/css/style.css" rel="stylesheet"><header><div><div id="textlogo"><h1 class="site-name"><a href="/" title="Mercury233">Mercury233</a></h1><h2 class="blog-motto">随便写写</h2></div><div class="navbar"><a href="#" class="navbutton navmobile" title="菜单"></a></div><nav class="animated"><ul><ul><li><a href="/">Home</a><li><a href="/archives">Archives</a><li><a href="/categories/%E4%BD%9C%E5%93%81/">Works</a><li><a href="/about">About</a><li><form accept-charset="utf-8" action="//google.com/search" class="search"><label>Search</label><input name="q" type="search" autocomplete="off" id="search" maxlength="20" placeholder="搜索"/> <input name="q" type="hidden" value="site:mercury233.me"></form></ul></nav></div></header><div id="container"><div class="post" id="main" itemprop="blogPost" itemscope><article itemprop="articleBody"><header class="clearfix article-info"><h1 itemprop="name"><a href="/2016/09/22/笔记：在Windows下编译YGOPRO/" title="笔记：在Windows下编译YGOPro" itemprop="url">笔记：在Windows下编译YGOPro</a></h1><p class="article-author">By <a href="/about" target="_blank" title="Mercury233" itemprop="author">Mercury233</a><p class="article-time"><time datetime="2016-09-22T14:10:00.000Z" itemprop="datePublished">发表于 2016-09-22</time></header><div class="article-content"><p>近期在 MyCard 项目中尝试了自动化编译 <a href="https://github.com/Fluorohydride/ygopro" target="_blank" rel="external">YGOPro</a>，发现官方采用 premake 生成项目文件，但并没有给出具体方法。故在此记录下折腾的成果。<br>本笔记基本上是参考了 <a href="https://github.com/DailyShana/ygopro/tree/build" target="_blank" rel="external">DailyShana 的 build 分支</a>写成，感谢 soarqin 和 DailyShana 的工作。<br>本笔记的操作在 Windows 7 和 Visual Studio Community 2015 上测试通过，理论上也可以适用于XP之后的系统。<p>2017-03-13 更新部分文件。<br><a id="more"></a><h1 id="0-_准备">0. 准备</h1><p>必须下载：<ul><li><a href="https://premake.github.io/" target="_blank" rel="external">Premake</a><br>下载地址：<a href="https://github.com/premake/premake-core/releases/download/v5.0.0-alpha11/premake-5.0.0-alpha11-windows.zip" target="_blank" rel="external">premake-5.0.0-alpha11-windows.zip</a><li><a href="http://libevent.org/" target="_blank" rel="external">libevent</a><br>下载地址：<a href="https://github.com/libevent/libevent/releases/download/release-2.0.22-stable/libevent-2.0.22-stable.tar.gz" target="_blank" rel="external">libevent-2.0.22-stable.tar.gz</a><li><a href="https://www.freetype.org/" target="_blank" rel="external">FreeType</a><br>下载地址：<a href="http://downloads.sourceforge.net/freetype/freetype-2.7.1.tar.bz2" target="_blank" rel="external">freetype-2.7.1.tar.bz2</a><li><a href="http://irrlicht.sourceforge.net/" target="_blank" rel="external">Irrlicht</a><br>下载地址：<a href="http://downloads.sourceforge.net/irrlicht/irrlicht-1.8.4.zip" target="_blank" rel="external">irrlicht-1.8.4.zip</a><li><a href="https://www.lua.org/" target="_blank" rel="external">Lua</a><br>下载地址：<a href="https://www.lua.org/ftp/lua-5.2.4.tar.gz" target="_blank" rel="external">lua-5.2.4.tar.gz</a><br>需注意不支持Lua 5.3。<li><a href="https://www.sqlite.org/" target="_blank" rel="external">SQLite</a><br>下载地址：<a href="https://www.sqlite.org/2017/sqlite-amalgamation-3170000.zip" target="_blank" rel="external">sqlite-amalgamation-3170000.zip</a></ul><p>建议下载：<ul><li><a href="https://git-for-windows.github.io/" target="_blank" rel="external">Git for Windows</a><br>用于自动获取和更新 YGOPro 的源码。此外其包含了 MSYS2，提供后文需要用到的 patch 工具。<br>如果不使用 git，你将需要手动下载 YGOPro 的子模块。此外，在上游和你都对源码做出修改后，你需要手动合并代码。<br><strong>本文默认你已经安装了 Git for Windows，并且设置了账号和 GitHub 的 ssh 公钥。</strong><li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=6812" target="_blank" rel="external">DirectX SDK</a><br>让 YGOPro 支持 Direct3D 模式的必备组件。<br>如果不安装 DirectX SDK，你将需要更改 Irrlicht 的配置文件，并且编译出的 YGOPro 将只能支持 OpenGL 模式。<li><a href="https://www.visualstudio.com/zh-cn/products/visual-studio-community-vs.aspx" target="_blank" rel="external">Visual Studio Community 2015</a><br>免费的正版Visual Studio，功能完全满足业余开发者的需求。</ul><h1 id="1-_获取_YGOPro_源码">1. 获取 YGOPro 源码</h1><p>YGOPro 以 GPL 协议开源，托管在 GitHub，用 <code>git clone</code> 即可获得。clone 时用 <code>--recursive</code> 来同时克隆子模块。<br><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/Fluorohydride/ygopro.git --recursive</span><br></pre></table></figure><p>子模块的引用往往不是最新的，需要 <code>git checkout master</code>。<br><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ygopro/</span><br><span class="line"><span class="built_in">cd</span> ocgcore/</span><br><span class="line">git checkout master</span><br><span class="line"><span class="built_in">cd</span> ../script/</span><br><span class="line">git checkout master</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></table></figure><h1 id="2-_Premake_简介">2. Premake 简介</h1><p>Premake 是一个命令行工具，用脚本定义软件工程，然后根据脚本为 Visual Studio, Xcode, 或 GNU Make 等工具生成项目文件。<a href="https://github.com/premake/premake-core/wiki/What-Is-Premake" target="_blank" rel="external">1</a><br>Premake 的脚本采用 lua 语言，十分简洁易懂，参考 <code>premake4.lua</code> 和 <code>ocgcore\premake4.lua</code> 即可略知一二。<br>于是，我们要做的就是给 <code>libevent</code>、<code>FreeType</code>、<code>Irrlicht</code>、<code>Lua</code> 和 <code>SQLite</code> 写 premake 文件，并最后用 Premake 生成 Visual Studio 的项目文件（解决方案）。<h1 id="3-_配置_libevent">3. 配置 libevent</h1><p>解压 <a href="https://github.com/libevent/libevent/releases/download/release-2.0.22-stable/libevent-2.0.22-stable.tar.gz" target="_blank" rel="external"><code>libevent-2.0.22-stable.tar.gz</code></a> 到项目目录，将文件夹重命名为 <code>event</code>。<br>为兼容 YGOPro 源码，将 <code>WIN32-Code</code> 文件夹里的文件全部移动到 <code>include</code> 文件夹。<br>根据 libevent 的 Makefile，得到如下 <a href="event/premake4.lua"><code>premake4.lua</code></a>，放到 <code>event</code> 文件夹里。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"event"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    includedirs { <span class="string">"include"</span>, <span class="string">"compat"</span> }</span><br><span class="line"></span><br><span class="line">    files { <span class="string">"event.c"</span>, <span class="string">"evthread.c"</span>, <span class="string">"buffer.c"</span>, <span class="string">"bufferevent.c"</span>, <span class="string">"bufferevent_sock.c"</span>,</span><br><span class="line">            <span class="string">"bufferevent_filter.c"</span>, <span class="string">"bufferevent_pair.c"</span>, <span class="string">"listener.c"</span>, <span class="string">"bufferevent_ratelim.c"</span>,</span><br><span class="line">            <span class="string">"evmap.c"</span>, <span class="string">"log.c"</span>, <span class="string">"evutil.c"</span>, <span class="string">"evutil_rand.c"</span>, <span class="string">"strlcpy.c"</span>, <span class="string">"signal.c"</span>, </span><br><span class="line">            <span class="string">"event_tagging.c"</span>, <span class="string">"http.c"</span>, <span class="string">"evdns.c"</span>, <span class="string">"evrpc.c"</span> }</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"windows"</span></span><br><span class="line">        files { <span class="string">"win32select.c"</span>, <span class="string">"evthread_win32.c"</span>, <span class="string">"buffer_iocp.c"</span>, <span class="string">"event_iocp.c"</span>, <span class="string">"bufferevent_async.c"</span> }</span><br></pre></table></figure><h1 id="4-_配置_FreeType">4. 配置 FreeType</h1><p>解压 <a href="http://downloads.sourceforge.net/freetype/freetype-2.7.1.tar.bz2" target="_blank" rel="external"><code>freetype-2.7.1.tar.bz2</code></a> 到项目目录，将文件夹重命名为 <code>freetype</code>。<br>根据 freetype 的 vcxproj，得到如下 <a href="freetype/premake4.lua"><code>premake4.lua</code></a>，放到 <code>freetype</code> 文件夹里。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"freetype"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    includedirs { <span class="string">"include"</span> }</span><br><span class="line">    defines { <span class="string">"FT2_BUILD_LIBRARY"</span> }</span><br><span class="line"></span><br><span class="line">    files { <span class="string">"src/autofit/autofit.c"</span>, <span class="string">"src/bdf/bdf.c"</span>, <span class="string">"src/cff/cff.c"</span>, <span class="string">"src/base/ftbase.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftbitmap.c"</span>, <span class="string">"src/cache/ftcache.c"</span>, <span class="string">"src/base/ftfstype.c"</span>, <span class="string">"src/base/ftgasp.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftglyph.c"</span>, <span class="string">"src/gzip/ftgzip.c"</span>, <span class="string">"src/base/ftinit.c"</span>, <span class="string">"src/lzw/ftlzw.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftstroke.c"</span>, <span class="string">"src/base/ftsystem.c"</span>, <span class="string">"src/smooth/smooth.c"</span>, <span class="string">"src/base/ftbbox.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftfntfmt.c"</span>, <span class="string">"src/base/ftmm.c"</span>, <span class="string">"src/base/ftpfr.c"</span>, <span class="string">"src/base/ftsynth.c"</span>,</span><br><span class="line">            <span class="string">"src/base/fttype1.c"</span>, <span class="string">"src/base/ftwinfnt.c"</span>, <span class="string">"src/base/ftlcdfil.c"</span>, <span class="string">"src/base/ftgxval.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftotval.c"</span>, <span class="string">"src/base/ftpatent.c"</span>, <span class="string">"src/pcf/pcf.c"</span>, <span class="string">"src/pfr/pfr.c"</span>,</span><br><span class="line">            <span class="string">"src/psaux/psaux.c"</span>, <span class="string">"src/pshinter/pshinter.c"</span>, <span class="string">"src/psnames/psmodule.c"</span>,</span><br><span class="line">            <span class="string">"src/raster/raster.c"</span>, <span class="string">"src/sfnt/sfnt.c"</span>, <span class="string">"src/truetype/truetype.c"</span>,</span><br><span class="line">            <span class="string">"src/type1/type1.c"</span>, <span class="string">"src/cid/type1cid.c"</span>, <span class="string">"src/type42/type42.c"</span>, <span class="string">"src/winfonts/winfnt.c"</span> }</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"windows"</span></span><br><span class="line">        files { <span class="string">"builds/windows/ftdebug.c"</span> }</span><br></pre></table></figure><h1 id="5-_配置_Irrlicht">5. 配置 Irrlicht</h1><p>解压 <a href="http://downloads.sourceforge.net/irrlicht/irrlicht-1.8.4.zip" target="_blank" rel="external"><code>irrlicht-1.8.4.zip</code></a> 到项目目录，将文件夹重命名为 <code>irrlicht</code>。<br>为兼容 YGOPro 源码，将 <code>source\Irrlicht</code> 剪切到 <code>irrlicht</code> 文件夹，重命名为 <code>src</code>。<br>Irrlicht 本身对中文显示和输入的支持存在问题，soarqin 和 DailyShana 给出了用于 Irrlicht 的中文支持。<br>将以下代码保存为 <a href="irrlicht/irrlicht.patch"><code>irrlicht.patch</code></a>，在MSYS的命令行下用 <code>patch</code> 应用即可。<br><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">diff --git a/irrlicht/include/IOSOperator.h b/irrlicht/include/IOSOperator.h</span><br><span class="line">index b5c6236..b2e864a 100644</span><br><span class="line"><span class="header">--- a/irrlicht/include/IOSOperator.h</span></span><br><span class="line"><span class="header">+++ b/irrlicht/include/IOSOperator.h</span></span><br><span class="line">@@ -26,11 +26,11 @@ public:</span><br><span class="line"> 	}</span><br><span class="line"> </span><br><span class="line"> 	//! Copies text to the clipboard</span><br><span class="line"><span class="deletion">-	virtual void copyToClipboard(const c8* text) const = 0;</span></span><br><span class="line"><span class="addition">+	virtual void copyToClipboard(const c16* text) const = 0;</span></span><br><span class="line"> </span><br><span class="line"> 	//! Get text from the clipboard</span><br><span class="line"> 	/** \return Returns 0 if no string is in there. */</span><br><span class="line"><span class="deletion">-	virtual const c8* getTextFromClipboard() const = 0;</span></span><br><span class="line"><span class="addition">+	virtual const c16* getTextFromClipboard() const = 0;</span></span><br><span class="line"> </span><br><span class="line"> 	//! Get the processor speed in megahertz</span><br><span class="line"> 	/** \param MHz The integer variable to store the speed in.</span><br><span class="line">diff --git a/irrlicht/include/IrrCompileConfig.h b/irrlicht/include/IrrCompileConfig.h</span><br><span class="line">index c2c5d12..7c44f0c 100644</span><br><span class="line"><span class="header">--- a/irrlicht/include/IrrCompileConfig.h</span></span><br><span class="line"><span class="header">+++ b/irrlicht/include/IrrCompileConfig.h</span></span><br><span class="line">@@ -233,7 +233,9 @@ you will not be able to use anything provided by the GUI Environment, including</span><br><span class="line"> disable this feature, the engine behave as before (ansi). This is currently only supported</span><br><span class="line"> for Windows based systems. You also have to set #define UNICODE for this to compile.</span><br><span class="line"> */</span><br><span class="line"><span class="deletion">-//#define _IRR_WCHAR_FILESYSTEM</span></span><br><span class="line"><span class="addition">+#if defined(_IRR_WINDOWS_) && (defined(_UNICODE) || defined(UNICODE))</span></span><br><span class="line"><span class="addition">+#define _IRR_WCHAR_FILESYSTEM</span></span><br><span class="line"><span class="addition">+#endif</span></span><br><span class="line"> #ifdef NO_IRR_WCHAR_FILESYSTEM</span><br><span class="line"> #undef _IRR_WCHAR_FILESYSTEM</span><br><span class="line"> #endif</span><br><span class="line">diff --git a/irrlicht/include/Keycodes.h b/irrlicht/include/Keycodes.h</span><br><span class="line">index e56eca1..57ab312 100644</span><br><span class="line"><span class="header">--- a/irrlicht/include/Keycodes.h</span></span><br><span class="line"><span class="header">+++ b/irrlicht/include/Keycodes.h</span></span><br><span class="line">@@ -89,7 +89,7 @@ namespace irr</span><br><span class="line"> 		KEY_KEY_X            = 0x58,  // X key</span><br><span class="line"> 		KEY_KEY_Y            = 0x59,  // Y key</span><br><span class="line"> 		KEY_KEY_Z            = 0x5A,  // Z key</span><br><span class="line"><span class="deletion">-		KEY_LWIN             = 0x5B,  // Left Windows key (Microsoft� Natural� keyboard)</span></span><br><span class="line"><span class="addition">+		KEY_LWIN             = 0x5B,  // Left Windows key (Microsoft® Natural® keyboard)</span></span><br><span class="line"> 		KEY_RWIN             = 0x5C,  // Right Windows key (Natural keyboard)</span><br><span class="line"> 		KEY_APPS             = 0x5D,  // Applications key (Natural keyboard)</span><br><span class="line"> 		KEY_SLEEP            = 0x5F,  // Computer Sleep key</span><br><span class="line">diff --git a/irrlicht/include/irrTypes.h b/irrlicht/include/irrTypes.h</span><br><span class="line">index cfeaf84..a656631 100644</span><br><span class="line"><span class="header">--- a/irrlicht/include/irrTypes.h</span></span><br><span class="line"><span class="header">+++ b/irrlicht/include/irrTypes.h</span></span><br><span class="line">@@ -48,7 +48,9 @@ typedef __int16			s16;</span><br><span class="line"> typedef signed short		s16;</span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="addition">+//! 16 bit character variable.</span></span><br><span class="line"><span class="addition">+/** This is a typedef for wchar_t, it ensures portability of the engine. */</span></span><br><span class="line"><span class="addition">+typedef wchar_t			c16;</span></span><br><span class="line"> </span><br><span class="line"> //! 32 bit unsigned variable.</span><br><span class="line"> /** This is a typedef for unsigned int, it ensures portability of the engine. */</span><br><span class="line">diff --git a/irrlicht/src/CGUIEditBox.cpp b/irrlicht/src/CGUIEditBox.cpp</span><br><span class="line">index f33b5a2..8375444 100644</span><br><span class="line"><span class="header">--- a/irrlicht/src/CGUIEditBox.cpp</span></span><br><span class="line"><span class="header">+++ b/irrlicht/src/CGUIEditBox.cpp</span></span><br><span class="line">@@ -287,7 +287,7 @@ bool CGUIEditBox::processKey(const SEvent& event)</span><br><span class="line"> 				const s32 realmbgn = MarkBegin &lt; MarkEnd ? MarkBegin : MarkEnd;</span><br><span class="line"> 				const s32 realmend = MarkBegin &lt; MarkEnd ? MarkEnd : MarkBegin;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-				core::stringc s;</span></span><br><span class="line"><span class="addition">+				core::stringw s;</span></span><br><span class="line"> 				s = Text.subString(realmbgn, realmend - realmbgn).c_str();</span><br><span class="line"> 				Operator->copyToClipboard(s.c_str());</span><br><span class="line"> 			}</span><br><span class="line">@@ -300,7 +300,7 @@ bool CGUIEditBox::processKey(const SEvent& event)</span><br><span class="line"> 				const s32 realmend = MarkBegin &lt; MarkEnd ? MarkEnd : MarkBegin;</span><br><span class="line"> </span><br><span class="line"> 				// copy</span><br><span class="line"><span class="deletion">-				core::stringc sc;</span></span><br><span class="line"><span class="addition">+				core::stringw sc;</span></span><br><span class="line"> 				sc = Text.subString(realmbgn, realmend - realmbgn).c_str();</span><br><span class="line"> 				Operator->copyToClipboard(sc.c_str());</span><br><span class="line"> </span><br><span class="line">@@ -330,16 +330,10 @@ bool CGUIEditBox::processKey(const SEvent& event)</span><br><span class="line"> 				const s32 realmend = MarkBegin &lt; MarkEnd ? MarkEnd : MarkBegin;</span><br><span class="line"> </span><br><span class="line"> 				// add new character</span><br><span class="line"><span class="deletion">-				const c8* p = Operator->getTextFromClipboard();</span></span><br><span class="line"><span class="addition">+				const c16* p = Operator->getTextFromClipboard();</span></span><br><span class="line"> 				if (p)</span><br><span class="line"> 				{</span><br><span class="line"><span class="deletion">-					// TODO: we should have such a function in core::string</span></span><br><span class="line"><span class="deletion">-					size_t lenOld = strlen(p);</span></span><br><span class="line"><span class="deletion">-					wchar_t *ws = new wchar_t[lenOld + 1];</span></span><br><span class="line"><span class="deletion">-					size_t len = mbstowcs(ws,p,lenOld);</span></span><br><span class="line"><span class="deletion">-					ws[len] = 0;</span></span><br><span class="line"><span class="deletion">-					irr::core::stringw widep(ws);</span></span><br><span class="line"><span class="deletion">-					delete[] ws;</span></span><br><span class="line"><span class="addition">+					irr::core::stringw widep(p);</span></span><br><span class="line"> </span><br><span class="line"> 					if (MarkBegin == MarkEnd)</span><br><span class="line"> 					{</span><br><span class="line">diff --git a/irrlicht/src/CIrrDeviceWin32.cpp b/irrlicht/src/CIrrDeviceWin32.cpp</span><br><span class="line">index f96c178..2e7a9ee 100644</span><br><span class="line"><span class="header">--- a/irrlicht/src/CIrrDeviceWin32.cpp</span></span><br><span class="line"><span class="header">+++ b/irrlicht/src/CIrrDeviceWin32.cpp</span></span><br><span class="line"><span class="chunk">@@ -20,6 +20,8 @@</span></span><br><span class="line"> #include "COSOperator.h"</span><br><span class="line"> #include "dimension2d.h"</span><br><span class="line"> #include "IGUISpriteBank.h"</span><br><span class="line"><span class="addition">+#include "IGUIEnvironment.h"</span></span><br><span class="line"><span class="addition">+#include "IGUIElement.h"</span></span><br><span class="line"> #include &lt;winuser.h></span><br><span class="line"> #if defined(_IRR_COMPILE_WITH_JOYSTICK_EVENTS_)</span><br><span class="line"> #ifdef _IRR_COMPILE_WITH_DIRECTINPUT_JOYSTICK_</span><br><span class="line">@@ -749,6 +751,26 @@ LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span><br><span class="line"> 		return 0;</span><br><span class="line"> 	}</span><br><span class="line"> </span><br><span class="line"><span class="addition">+	{</span></span><br><span class="line"><span class="addition">+		dev = getDeviceFromHWnd(hWnd);</span></span><br><span class="line"><span class="addition">+		if (dev)</span></span><br><span class="line"><span class="addition">+		{</span></span><br><span class="line"><span class="addition">+			irr::gui::IGUIElement* ele = dev->getGUIEnvironment()->getFocus();</span></span><br><span class="line"><span class="addition">+			if (!ele || (ele->getType() != irr::gui::EGUIET_EDIT_BOX) || !ele->isEnabled())</span></span><br><span class="line"><span class="addition">+			{</span></span><br><span class="line"><span class="addition">+				HIMC hIMC = ImmGetContext(hWnd);</span></span><br><span class="line"><span class="addition">+				if (hIMC)</span></span><br><span class="line"><span class="addition">+				{</span></span><br><span class="line"><span class="addition">+					ImmNotifyIME(hIMC, NI_COMPOSITIONSTR, CPS_COMPLETE, 0);</span></span><br><span class="line"><span class="addition">+					ImmReleaseContext(hWnd, hIMC);</span></span><br><span class="line"><span class="addition">+				}</span></span><br><span class="line"><span class="addition">+				ImmAssociateContextEx(hWnd, NULL, 0);</span></span><br><span class="line"><span class="addition">+			}</span></span><br><span class="line"><span class="addition">+			else</span></span><br><span class="line"><span class="addition">+				ImmAssociateContextEx(hWnd, NULL, IACE_DEFAULT);</span></span><br><span class="line"><span class="addition">+		}</span></span><br><span class="line"><span class="addition">+	}</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"> 	switch (message)</span><br><span class="line"> 	{</span><br><span class="line"> 	case WM_PAINT:</span><br><span class="line">@@ -773,22 +795,21 @@ LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span><br><span class="line"> 			event.KeyInput.Key = (irr::EKEY_CODE)wParam;</span><br><span class="line"> 			event.KeyInput.PressedDown = (message==WM_KEYDOWN || message == WM_SYSKEYDOWN);</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-			const UINT MY_MAPVK_VSC_TO_VK_EX = 3; // MAPVK_VSC_TO_VK_EX should be in SDK according to MSDN, but isn't in mine.</span></span><br><span class="line"> 			if ( event.KeyInput.Key == irr::KEY_SHIFT )</span><br><span class="line"> 			{</span><br><span class="line"> 				// this will fail on systems before windows NT/2000/XP, not sure _what_ will return there instead.</span><br><span class="line"><span class="deletion">-				event.KeyInput.Key = (irr::EKEY_CODE)MapVirtualKey( ((lParam>>16) & 255), MY_MAPVK_VSC_TO_VK_EX );</span></span><br><span class="line"><span class="addition">+				event.KeyInput.Key = (irr::EKEY_CODE)MapVirtualKey( ((lParam>>16) & 255), MAPVK_VSC_TO_VK_EX );</span></span><br><span class="line"> 			}</span><br><span class="line"> 			if ( event.KeyInput.Key == irr::KEY_CONTROL )</span><br><span class="line"> 			{</span><br><span class="line"><span class="deletion">-				event.KeyInput.Key = (irr::EKEY_CODE)MapVirtualKey( ((lParam>>16) & 255), MY_MAPVK_VSC_TO_VK_EX );</span></span><br><span class="line"><span class="addition">+				event.KeyInput.Key = (irr::EKEY_CODE)MapVirtualKey( ((lParam>>16) & 255), MAPVK_VSC_TO_VK_EX );</span></span><br><span class="line"> 				// some keyboards will just return LEFT for both - left and right keys. So also check extend bit.</span><br><span class="line"> 				if (lParam & 0x1000000)</span><br><span class="line"> 					event.KeyInput.Key = irr::KEY_RCONTROL;</span><br><span class="line"> 			}</span><br><span class="line"> 			if ( event.KeyInput.Key == irr::KEY_MENU )</span><br><span class="line"> 			{</span><br><span class="line"><span class="deletion">-				event.KeyInput.Key = (irr::EKEY_CODE)MapVirtualKey( ((lParam>>16) & 255), MY_MAPVK_VSC_TO_VK_EX );</span></span><br><span class="line"><span class="addition">+				event.KeyInput.Key = (irr::EKEY_CODE)MapVirtualKey( ((lParam>>16) & 255), MAPVK_VSC_TO_VK_EX );</span></span><br><span class="line"> 				if (lParam & 0x1000000)</span><br><span class="line"> 					event.KeyInput.Key = irr::KEY_RMENU;</span><br><span class="line"> 			}</span><br><span class="line">@@ -904,6 +925,53 @@ LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)</span><br><span class="line"> 		KEYBOARD_INPUT_HKL = GetKeyboardLayout(0);</span><br><span class="line"> 		KEYBOARD_INPUT_CODEPAGE = LocaleIdToCodepage( LOWORD(KEYBOARD_INPUT_HKL) );</span><br><span class="line"> 		return 0;</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+	case WM_IME_STARTCOMPOSITION:</span></span><br><span class="line"><span class="addition">+		{</span></span><br><span class="line"><span class="addition">+			dev = getDeviceFromHWnd(hWnd);</span></span><br><span class="line"><span class="addition">+			irr::gui::IGUIElement* ele = dev->getGUIEnvironment()->getFocus();</span></span><br><span class="line"><span class="addition">+			if (!ele)</span></span><br><span class="line"><span class="addition">+				break;</span></span><br><span class="line"><span class="addition">+			irr::core::position2di pos = ele->getAbsolutePosition().UpperLeftCorner;</span></span><br><span class="line"><span class="addition">+			COMPOSITIONFORM CompForm = { CFS_POINT, { pos.X, pos.Y + ele->getAbsolutePosition().getHeight() } };</span></span><br><span class="line"><span class="addition">+			HIMC hIMC = ImmGetContext(hWnd);</span></span><br><span class="line"><span class="addition">+			ImmSetCompositionWindow(hIMC, &CompForm);</span></span><br><span class="line"><span class="addition">+			ImmReleaseContext(hWnd, hIMC);</span></span><br><span class="line"><span class="addition">+		}</span></span><br><span class="line"><span class="addition">+		break;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+	case WM_IME_CHAR:</span></span><br><span class="line"><span class="addition">+		event.EventType = irr::EET_KEY_INPUT_EVENT;</span></span><br><span class="line"><span class="addition">+		event.KeyInput.PressedDown = true;</span></span><br><span class="line"><span class="addition">+#ifdef _UNICODE</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Char = wParam;</span></span><br><span class="line"><span class="addition">+#else</span></span><br><span class="line"><span class="addition">+		BYTE ch[3];</span></span><br><span class="line"><span class="addition">+		if(wParam >> 8) {</span></span><br><span class="line"><span class="addition">+			ch[0] = wParam >> 8;</span></span><br><span class="line"><span class="addition">+			ch[1] = wParam & 0xff;</span></span><br><span class="line"><span class="addition">+			ch[2] = 0;</span></span><br><span class="line"><span class="addition">+		} else {</span></span><br><span class="line"><span class="addition">+			ch[0] = wParam;</span></span><br><span class="line"><span class="addition">+			ch[1] = 0;</span></span><br><span class="line"><span class="addition">+		}</span></span><br><span class="line"><span class="addition">+		WORD unicodeChar;</span></span><br><span class="line"><span class="addition">+		MultiByteToWideChar(</span></span><br><span class="line"><span class="addition">+			KEYBOARD_INPUT_CODEPAGE,</span></span><br><span class="line"><span class="addition">+			MB_PRECOMPOSED, // default</span></span><br><span class="line"><span class="addition">+			(LPCSTR)ch,</span></span><br><span class="line"><span class="addition">+			sizeof(wParam),</span></span><br><span class="line"><span class="addition">+			(WCHAR*)&unicodeChar,</span></span><br><span class="line"><span class="addition">+			1);</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Char = unicodeChar;</span></span><br><span class="line"><span class="addition">+#endif</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Key = irr::KEY_ACCEPT;</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Shift = 0;</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Control = 0;</span></span><br><span class="line"><span class="addition">+		dev = getDeviceFromHWnd(hWnd);</span></span><br><span class="line"><span class="addition">+		if (dev)</span></span><br><span class="line"><span class="addition">+			dev->postEventFromUser(event);</span></span><br><span class="line"><span class="addition">+		return 0;</span></span><br><span class="line"> 	}</span><br><span class="line"> 	return DefWindowProc(hWnd, message, wParam, lParam);</span><br><span class="line"> }</span><br><span class="line">@@ -1797,8 +1865,8 @@ void CIrrDeviceWin32::handleSystemMessages()</span><br><span class="line"> </span><br><span class="line"> 	while (PeekMessage(&msg, NULL, 0, 0, PM_REMOVE))</span><br><span class="line"> 	{</span><br><span class="line"><span class="deletion">-		// No message translation because we don't use WM_CHAR and it would conflict with our</span></span><br><span class="line"><span class="deletion">-		// deadkey handling.</span></span><br><span class="line"><span class="addition">+		// conflict with deadkey handling.</span></span><br><span class="line"><span class="addition">+		TranslateMessage(&msg);</span></span><br><span class="line"> </span><br><span class="line"> 		if (ExternalWindow && msg.hwnd == HWnd)</span><br><span class="line"> 			WndProc(HWnd, msg.message, msg.wParam, msg.lParam);</span><br><span class="line">diff --git a/irrlicht/src/COSOperator.cpp b/irrlicht/src/COSOperator.cpp</span><br><span class="line">index 90e644d..1856c04 100644</span><br><span class="line"><span class="header">--- a/irrlicht/src/COSOperator.cpp</span></span><br><span class="line"><span class="header">+++ b/irrlicht/src/COSOperator.cpp</span></span><br><span class="line">@@ -52,9 +52,9 @@ const core::stringc& COSOperator::getOperatingSystemVersion() const</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> //! copies text to the clipboard</span><br><span class="line"><span class="deletion">-void COSOperator::copyToClipboard(const c8* text) const</span></span><br><span class="line"><span class="addition">+void COSOperator::copyToClipboard(const c16* text) const</span></span><br><span class="line"> {</span><br><span class="line"><span class="deletion">-	if (strlen(text)==0)</span></span><br><span class="line"><span class="addition">+	if (wcslen(text)==0)</span></span><br><span class="line"> 		return;</span><br><span class="line"> </span><br><span class="line"> // Windows version</span><br><span class="line">@@ -66,15 +66,15 @@ void COSOperator::copyToClipboard(const c8* text) const</span><br><span class="line"> 	EmptyClipboard();</span><br><span class="line"> </span><br><span class="line"> 	HGLOBAL clipbuffer;</span><br><span class="line"><span class="deletion">-	char * buffer;</span></span><br><span class="line"><span class="addition">+	wchar_t * buffer;</span></span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	clipbuffer = GlobalAlloc(GMEM_DDESHARE, strlen(text)+1);</span></span><br><span class="line"><span class="deletion">-	buffer = (char*)GlobalLock(clipbuffer);</span></span><br><span class="line"><span class="addition">+	clipbuffer = GlobalAlloc(GMEM_DDESHARE, sizeof(wchar_t) * (wcslen(text) + 1));</span></span><br><span class="line"><span class="addition">+	buffer = (wchar_t*)GlobalLock(clipbuffer);</span></span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	strcpy(buffer, text);</span></span><br><span class="line"><span class="addition">+	wcscpy(buffer, text);</span></span><br><span class="line"> </span><br><span class="line"> 	GlobalUnlock(clipbuffer);</span><br><span class="line"><span class="deletion">-	SetClipboardData(CF_TEXT, clipbuffer);</span></span><br><span class="line"><span class="addition">+	SetClipboardData(CF_UNICODETEXT, clipbuffer);</span></span><br><span class="line"> 	CloseClipboard();</span><br><span class="line"> </span><br><span class="line"> // MacOSX version</span><br><span class="line">@@ -93,7 +93,7 @@ void COSOperator::copyToClipboard(const c8* text) const</span><br><span class="line"> </span><br><span class="line"> //! gets text from the clipboard</span><br><span class="line"> //! \return Returns 0 if no string is in there.</span><br><span class="line"><span class="deletion">-const c8* COSOperator::getTextFromClipboard() const</span></span><br><span class="line"><span class="addition">+const c16* COSOperator::getTextFromClipboard() const</span></span><br><span class="line"> {</span><br><span class="line"> #if defined(_IRR_XBOX_PLATFORM_)</span><br><span class="line"> 		return 0;</span><br><span class="line">@@ -101,10 +101,10 @@ const c8* COSOperator::getTextFromClipboard() const</span><br><span class="line"> 	if (!OpenClipboard(NULL))</span><br><span class="line"> 		return 0;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	char * buffer = 0;</span></span><br><span class="line"><span class="addition">+	wchar_t * buffer = 0;</span></span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	HANDLE hData = GetClipboardData( CF_TEXT );</span></span><br><span class="line"><span class="deletion">-	buffer = (char*)GlobalLock( hData );</span></span><br><span class="line"><span class="addition">+	HANDLE hData = GetClipboardData( CF_UNICODETEXT );</span></span><br><span class="line"><span class="addition">+	buffer = (wchar_t*)GlobalLock( hData );</span></span><br><span class="line"> 	GlobalUnlock( hData );</span><br><span class="line"> 	CloseClipboard();</span><br><span class="line"> 	return buffer;</span><br><span class="line">diff --git a/irrlicht/src/COSOperator.h b/irrlicht/src/COSOperator.h</span><br><span class="line">index 3f633da..c0712df 100644</span><br><span class="line"><span class="header">--- a/irrlicht/src/COSOperator.h</span></span><br><span class="line"><span class="header">+++ b/irrlicht/src/COSOperator.h</span></span><br><span class="line">@@ -27,11 +27,11 @@ public:</span><br><span class="line"> 	virtual const core::stringc& getOperatingSystemVersion() const;</span><br><span class="line"> </span><br><span class="line"> 	//! copies text to the clipboard</span><br><span class="line"><span class="deletion">-	virtual void copyToClipboard(const c8* text) const;</span></span><br><span class="line"><span class="addition">+	virtual void copyToClipboard(const c16* text) const;</span></span><br><span class="line"> </span><br><span class="line"> 	//! gets text from the clipboard</span><br><span class="line"> 	//! \return Returns 0 if no string is in there.</span><br><span class="line"><span class="deletion">-	virtual const c8* getTextFromClipboard() const;</span></span><br><span class="line"><span class="addition">+	virtual const c16* getTextFromClipboard() const;</span></span><br><span class="line"> </span><br><span class="line"> 	//! gets the processor speed in megahertz</span><br><span class="line"> 	//! \param Mhz:</span><br></pre></table></figure><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">patch -p1 &lt; irrlicht\irrlicht.patch</span><br></pre></table></figure><p>根据 irrlicht 的 vcxproj，得到如下 <a href="irrlicht/premake5.lua"><code>premake5.lua</code></a>，放到 <code>irrlicht</code> 文件夹里。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"Irrlicht"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    includedirs { <span class="string">"include"</span>, <span class="string">"src"</span>, <span class="string">"src/jpeglib"</span>, <span class="string">"src/libpng"</span>, <span class="string">"src/zlib"</span> }</span><br><span class="line">    </span><br><span class="line">    defines { <span class="string">"_IRR_STATIC_LIB_"</span> }</span><br><span class="line">    exceptionhandling <span class="string">"Off"</span></span><br><span class="line">    rtti <span class="string">"Off"</span></span><br><span class="line">    </span><br><span class="line">    files { <span class="string">"src/CCgMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9CgMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDefaultSceneNodeAnimatorFactory.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDefaultSceneNodeFactory.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGeometryCreator.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMeshCache.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMeshManipulator.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLCgMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneManager.cpp"</span>,</span><br><span class="line">            <span class="string">"src/C3DSMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSMFMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAnimatedMeshHalfLife.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAnimatedMeshMD2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAnimatedMeshMD3.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CB3DMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CBSPMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CColladaFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CCSMLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDMFLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLMTSMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLWOMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMD2MeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMD3MeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMS3DMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMY3DMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COBJMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COCTLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COgreMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CPLYMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CQ3LevelMesh.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSkinnedMesh.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSTLMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CXMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAnimatedMeshSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CBillboardSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CBoneSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CCameraSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CCubeSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDummyTransformationSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CEmptySceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLightSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMeshSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COctreeSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CQuake3ShaderSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CShadowVolumeSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSkyBoxSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSkyDomeSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSphereSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTerrainSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTextSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CVolumeLightSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CWaterSurfaceSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleAnimatedMeshSceneNodeEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleAttractionAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleBoxEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleCylinderEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleFadeOutAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleGravityAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleMeshEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticlePointEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleRingEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleRotationAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleScaleAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleSphereEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleSystemSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMetaTriangleSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COctreeTriangleSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneCollisionManager.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTerrainTriangleSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTriangleBBSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTriangleSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneLoaderIrr.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorCameraFPS.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorCameraMaya.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorCollisionResponse.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorDelete.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorFlyCircle.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorFlyStraight.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorFollowSpline.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorRotation.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorTexture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CColladaMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COBJMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CPLYMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSTLMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CVideoModeList.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSoftwareDriver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSoftwareTexture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRFlat.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRFlatWire.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraud.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraudWire.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureFlat.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureFlatWire.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraud.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAdd.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudNoZ.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudWire.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CZBuffer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLDriver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLExtensionHandler.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLNormalMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLParallaxMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLShaderMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLSLMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLTexture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8Driver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8NormalMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8ParallaxMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8ShaderMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8Texture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CColorConverter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CFPSCounter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImage.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CNullDriver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterBMP.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterJPG.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterPCX.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterPNG.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterPPM.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterPSD.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterTGA.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderBMP.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderDDS.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderJPG.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderPCX.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderPNG.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderPPM.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderPSD.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderRGB.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderTGA.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderWAL.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9Driver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9HLSLMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9NormalMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9ParallaxMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9ShaderMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9Texture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CBurningShader_Raster_Reference.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDepthBuffer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSoftwareDriver2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSoftwareTexture2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraud2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraudAlpha2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraudAlphaNoZ2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRNormalMap.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRStencilShadow.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureBlend.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureDetailMap2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraud2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAdd2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAddNoZ2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAlpha.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAlphaNoZ.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudNoZ2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudVertexAlpha2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMap2_Add.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMap2_M1.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMap2_M2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMap2_M4.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMapGouraud2_M4.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureWire2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/IBurningShader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLogger.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COSOperator.cpp"</span>,</span><br><span class="line">            <span class="string">"src/Irrlicht.cpp"</span>,</span><br><span class="line">            <span class="string">"src/os.cpp"</span>,</span><br><span class="line">            <span class="string">"src/lzma/LzmaDec.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/adler32.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/compress.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/crc32.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/deflate.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/inffast.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/inflate.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/inftrees.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/trees.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/uncompr.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/zutil.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jaricom.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcapimin.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcapistd.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcarith.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jccoefct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jccolor.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcdctmgr.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jchuff.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcinit.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcmainct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcmarker.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcmaster.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcomapi.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcparam.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcprepct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcsample.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jctrans.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdapimin.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdapistd.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdarith.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdatadst.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdatasrc.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdcoefct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdcolor.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jddctmgr.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdhuff.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdinput.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdmainct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdmarker.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdmaster.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdmerge.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdpostct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdsample.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdtrans.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jerror.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jfdctflt.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jfdctfst.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jfdctint.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jidctflt.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jidctfst.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jidctint.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jmemmgr.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jmemnobs.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jquant1.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jquant2.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jutils.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/png.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngerror.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngget.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngmem.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngpread.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngread.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngrio.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngrtran.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngrutil.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngset.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngtrans.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngwio.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngwrite.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngwtran.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngwutil.c"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/aescrypt.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/aeskey.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/aestab.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/fileenc.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/hmac.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/prng.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/pwd2key.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/sha1.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/sha2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/blocksort.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/bzcompress.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/bzlib.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/crctable.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/decompress.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/huffman.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/randtable.c"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceConsole.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceFB.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceLinux.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceSDL.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceStub.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceWin32.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceWinCE.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAttributes.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CFileList.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CFileSystem.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLimitReadFile.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMemoryFile.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMountPointReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CNPKReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CPakReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CReadFile.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTarReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CWADReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CWriteFile.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CXMLReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CXMLWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CZipReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/irrXML.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDefaultGUIElementFactory.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIButton.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUICheckbox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIColorSelectDialog.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIComboBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIContextMenu.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIEditBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIEnvironment.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIFileOpenDialog.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIFont.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIImage.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIImageList.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIInOutFader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIListBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIMenu.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIMeshViewer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIMessageBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIModalScreen.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIScrollBar.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUISkin.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUISpinBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUISpriteBank.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIStaticText.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUITabControl.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUITable.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIToolBar.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUITreeView.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIWindow.cpp"</span> }</span><br><span class="line"></span><br><span class="line">    configuration { <span class="string">"vs*"</span> }</span><br><span class="line">        includedirs { <span class="string">"$(DXSDK_DIR)include"</span> }</span><br><span class="line">        libdirs { <span class="string">"$(DXSDK_DIR)Lib/x86"</span> }</span><br><span class="line"></span><br><span class="line">    configuration { <span class="string">"windows"</span> }</span><br><span class="line">        links { <span class="string">"imm32"</span> }</span><br></pre></table></figure><h1 id="5-_配置_Lua">5. 配置 Lua</h1><p>解压 <a href="https://www.lua.org/ftp/lua-5.2.4.tar.gz" target="_blank" rel="external"><code>lua-5.2.4.tar.gz</code></a> 到项目目录，将文件夹重命名为 <code>lua</code>。<br>为兼容 YGOPro 源码，将 <code>src</code> 文件夹里除 Makefile 外的文件全部移动到 <code>lua</code> 文件夹。<br>Lua 源码的文件结构非常简单，直接把如下 <a href="lua/premake4.lua"><code>premake4.lua</code></a> 放到 <code>lua</code> 文件夹里即可。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"lua"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    files { <span class="string">"*.c"</span>, <span class="string">"*.h"</span> }</span><br><span class="line">    removefiles { <span class="string">"luac.c"</span> }</span><br></pre></table></figure><h1 id="6-_配置_SQLite">6. 配置 SQLite</h1><p>解压 <a href="https://www.sqlite.org/2017/sqlite-amalgamation-3170000.zip" target="_blank" rel="external"><code>sqlite-amalgamation-3170000.zip</code></a> 到项目目录，将文件夹重命名为 <code>sqlite3</code>。<br>SQLite 源码的文件结构非常简单，直接把如下 <a href="sqlite3/premake4.lua"><code>premake4.lua</code></a> 放到 <code>sqlite3</code> 文件夹里即可。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"sqlite3"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    files { <span class="string">"sqlite3.c"</span>, <span class="string">"sqlite3.h"</span> }</span><br></pre></table></figure><h1 id="7-_生成解决方案">7. 生成解决方案</h1><p>在生成解决方案之前，我们还需要对 premake 做几个设置。<br>打开项目目录中的 <code>premake4.lua</code>，将其改为如下 <a href="premake5.lua"><code>premake5.lua</code></a>。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">solution <span class="string">"ygo"</span></span><br><span class="line">    location <span class="string">"build"</span></span><br><span class="line">    language <span class="string">"C++"</span></span><br><span class="line">    objdir <span class="string">"obj"</span></span><br><span class="line"></span><br><span class="line">    configurations { <span class="string">"Debug"</span>, <span class="string">"Release"</span> }</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"windows"</span></span><br><span class="line">        defines { <span class="string">"WIN32"</span>, <span class="string">"_WIN32"</span>, <span class="string">"WINVER=0x0501"</span> }</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"bsd"</span></span><br><span class="line">        defines { <span class="string">"LUA_USE_POSIX"</span> }</span><br><span class="line">        includedirs { <span class="string">"/usr/local/include"</span> }</span><br><span class="line">        libdirs { <span class="string">"/usr/local/lib"</span> }</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"macosx"</span></span><br><span class="line">        defines { <span class="string">"LUA_USE_MACOSX"</span> }</span><br><span class="line">        includedirs { <span class="string">"/usr/local/include/*"</span> }</span><br><span class="line">        libdirs { <span class="string">"/usr/local/lib"</span>, <span class="string">"/usr/X11/lib"</span> }</span><br><span class="line">        buildoptions { <span class="string">"-stdlib=libc++"</span> }</span><br><span class="line">        links { <span class="string">"OpenGL.framework"</span>, <span class="string">"Cocoa.framework"</span>, <span class="string">"IOKit.framework"</span> }</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"linux"</span></span><br><span class="line">        defines { <span class="string">"LUA_USE_LINUX"</span> }</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"Release"</span></span><br><span class="line">        flags { <span class="string">"OptimizeSpeed"</span> }</span><br><span class="line">        targetdir <span class="string">"bin/release"</span></span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"Debug"</span></span><br><span class="line">        symbols <span class="string">"On"</span></span><br><span class="line">        defines <span class="string">"_DEBUG"</span></span><br><span class="line">        targetdir <span class="string">"bin/debug"</span></span><br><span class="line"></span><br><span class="line">    configuration { <span class="string">"Release"</span>, <span class="string">"vs*"</span> }</span><br><span class="line">        flags { <span class="string">"StaticRuntime"</span>, <span class="string">"LinkTimeOptimization"</span> }</span><br><span class="line">        disablewarnings { <span class="string">"4244"</span>, <span class="string">"4267"</span>, <span class="string">"4838"</span>, <span class="string">"4577"</span>, <span class="string">"4819"</span>, <span class="string">"4018"</span>, <span class="string">"4996"</span>, <span class="string">"4477"</span> }</span><br><span class="line"></span><br><span class="line">    configuration { <span class="string">"Release"</span>, <span class="string">"not vs*"</span> }</span><br><span class="line">        symbols <span class="string">"On"</span></span><br><span class="line">        defines <span class="string">"NDEBUG"</span></span><br><span class="line">        buildoptions <span class="string">"-march=native"</span></span><br><span class="line"></span><br><span class="line">    configuration { <span class="string">"Debug"</span>, <span class="string">"vs*"</span> }</span><br><span class="line">        defines { <span class="string">"_ITERATOR_DEBUG_LEVEL=0"</span> }</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"vs*"</span></span><br><span class="line">        flags <span class="string">"EnableSSE2"</span></span><br><span class="line">        defines { <span class="string">"_CRT_SECURE_NO_WARNINGS"</span> }</span><br><span class="line">    </span><br><span class="line">    configuration <span class="string">"not vs*"</span></span><br><span class="line">        buildoptions { <span class="string">"-fno-strict-aliasing"</span>, <span class="string">"-Wno-multichar"</span> }</span><br><span class="line"></span><br><span class="line">    configuration {<span class="string">"not vs*"</span>, <span class="string">"windows"</span>}</span><br><span class="line">        buildoptions { <span class="string">"-static-libgcc"</span> }</span><br><span class="line"></span><br><span class="line">    startproject <span class="string">"ygopro"</span></span><br><span class="line"></span><br><span class="line">    include <span class="string">"ocgcore"</span></span><br><span class="line">    include <span class="string">"gframe"</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">os</span>.is(<span class="string">"windows"</span>) <span class="keyword">then</span></span><br><span class="line">    include <span class="string">"event"</span></span><br><span class="line">    include <span class="string">"freetype"</span></span><br><span class="line">    include <span class="string">"irrlicht"</span></span><br><span class="line">    include <span class="string">"lua"</span></span><br><span class="line">    include <span class="string">"sqlite3"</span></span><br><span class="line">    <span class="keyword">end</span></span><br></pre></table></figure><p>解压 <a href="https://github.com/premake/premake-core/releases/download/v5.0.0-alpha11/premake-5.0.0-alpha11-windows.zip" target="_blank" rel="external"><code>premake-5.0.0-alpha11-windows.zip</code></a> 到项目目录。<br>运行 <code>premake5 vs2015</code> 即可在 <code>build</code> 文件夹内生成sln文件。<br>程序还需要一个资源文件，把如下 <a href="gframe/ygopro.rc"><code>ygopro.rc</code></a> 和 <a href="gframe/ygopro.ico"><code>ygopro.ico</code></a> 放到 <code>gframe</code> 文件夹里。<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1 ICON "ygopro.ico"</span><br><span class="line"></span><br><span class="line">1 VERSIONINFO</span><br><span class="line">FILEVERSION 1, 0, 33, 13</span><br><span class="line">PRODUCTVERSION 1, 0, 33, 13</span><br><span class="line">FILEOS 0x4</span><br><span class="line">FILETYPE 0x1</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">BLOCK</span> <span class="string">"StringFileInfo"</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">BLOCK</span> <span class="string">"080404b0"</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"FileDescription"</span>, <span class="string">"YGOPro"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"InternalName"</span>, <span class="string">"YGOPro"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"LegalCopyright"</span>, <span class="string">"Copyright (C) 2017 Fluorohydride"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"OriginalFilename"</span>, <span class="string">"ygopro.exe"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"ProductName"</span>, <span class="string">"YGOPro"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"FileVersion"</span>, <span class="string">"1.033.D.233"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"ProductVersion"</span>, <span class="string">"1.033.D.233"</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">BLOCK</span> <span class="string">"VarFileInfo"</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"Translation"</span>, <span class="number">0x804</span>, <span class="number">1200</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">END</span></span></span><br></pre></table></figure><h1 id="8-_选项设置">8. 选项设置</h1><p>完成了以上步骤后，我们的 ygo 项目已经可以用 VS2015 打开并编译了。<br>如需要程序支持XP，在 <code>ygopro</code> 的属性中将 <code>平台工具集</code> 设置为 <code>Visual Studio 2015 - Windows XP (v140_xp)</code>。<br>别忘记把 <code>解决方案配置</code> 改成 <code>Release</code>。</div><footer class="clearfix article-footer"><div class="article-catetags"><div class="article-tags"><span></span> <a href="/tags/经验/">经验</a></div></div><div class="article-share" id="share"><div class="clearfix share" data-title="笔记：在Windows下编译YGOPro | Mercury233" data-tsina="null" data-url="http://mercury233.me/2016/09/22/笔记：在Windows下编译YGOPRO/"></div></div></footer></article><nav class="clearfix article-nav"><div class="next"><a href="/2016/03/13/网页中相对路径的一个坑/" title="网页中相对路径的一个坑"><strong>下一篇：</strong><br/><span>网页中相对路径的一个坑</span></a></div></nav><section class="comment" id="comments"><div id="uyan_frame"></div><script src="http://v2.uyan.cc/code/uyan.js?uid=2088351"></script></section></div><div class="openaside"><a href="#" class="navbutton" title="显示侧边栏"></a></div><div id="asidepart"><div class="closeaside"><a href="#" class="closebutton" title="隐藏侧边栏"></a></div><aside class="clearfix"><div class="tagslist"><p class="asidetitle">标签<ul class="clearfix"><li><a href="/tags/技巧/" title="技巧">技巧<sup>5</sup></a><li><a href="/tags/百度空间存档/" title="百度空间存档">百度空间存档<sup>4</sup></a><li><a href="/tags/游戏王/" title="游戏王">游戏王<sup>3</sup></a><li><a href="/tags/原创软件/" title="原创软件">原创软件<sup>3</sup></a><li><a href="/tags/原创Web-App/" title="原创Web App">原创Web App<sup>2</sup></a><li><a href="/tags/经验/" title="经验">经验<sup>2</sup></a><li><a href="/tags/游戏/" title="游戏">游戏<sup>1</sup></a></ul></div><div class="archiveslist"><p class="asidetitle"><a href="/archives">归档</a><ul class="archive-list"><li class="archive-list-item"><a href="/archives/2016/09/" class="archive-list-link">九月 2016</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2016/03/" class="archive-list-link">三月 2016</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2015/10/" class="archive-list-link">十月 2015</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2015/09/" class="archive-list-link">九月 2015</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2015/08/" class="archive-list-link">八月 2015</a><span class="archive-list-count">2</span><li class="archive-list-item"><a href="/archives/2014/09/" class="archive-list-link">九月 2014</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2013/08/" class="archive-list-link">八月 2013</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2013/03/" class="archive-list-link">三月 2013</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2012/11/" class="archive-list-link">十一月 2012</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2009/12/" class="archive-list-link">十二月 2009</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2008/10/" class="archive-list-link">十月 2008</a><span class="archive-list-count">1</span><li class="archive-list-item"><a href="/archives/2008/05/" class="archive-list-link">五月 2008</a><span class="archive-list-count">1</span></ul></div><div class="archiveslist"><p class="asidetitle">最新文章<ul class="archive-list"><li class="archive-list-item"><a href="/2016/09/22/笔记：在Windows下编译YGOPRO/" class="archive-list-link">笔记：在Windows下编译YGOPro</a><li class="archive-list-item"><a href="/2016/03/13/网页中相对路径的一个坑/" class="archive-list-link">网页中相对路径的一个坑</a><li class="archive-list-item"><a href="/2015/10/14/卡池生成器/" class="archive-list-link">卡池生成器</a><li class="archive-list-item"><a href="/2015/09/17/hello-world/" class="archive-list-link">Hello World</a><li class="archive-list-item"><a href="/2015/08/12/网页版三国杀传奇数据表/" class="archive-list-link">网页版三国杀传奇数据表</a></ul></div><div class="linkslist"><p class="asidetitle">友情链接<ul><li><a href="https://hexo.io/zh-cn/" target="_blank" title="hexo">hexo</a></ul></div></aside></div></div><footer><div id="footer"><div class="social-font" class="clearfix"><a href="https://github.com/mercury233" target="_blank" title="github" class="icon-github"></a></div><div class="cc-license"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank" class="cc-opacity"><img alt="Creative Commons" src="/img/cc-by-nc-sa.svg"/></a></div><p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 <a href="/about" target="_blank" title="Mercury233">Mercury233</a></div></footer><script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script>$(document).ready(function(){function e(){"number"==typeof window.innerWidth?n=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(n=document.documentElement.clientWidth)}$(".navbar").click(function(){$("header nav").toggleClass("shownav")});var n=0,s=$("#main"),a=$("#asidepart"),o=$(".closeaside"),d=$(".openaside");o.click(function(){a.addClass("fadeOut").css("display","none"),d.css("display","block").addClass("fadeIn"),s.addClass("moveMain")}),d.click(function(){d.css("display","none").removeClass("beforeFadeIn"),a.css("display","block").removeClass("fadeOut").addClass("fadeIn"),s.removeClass("moveMain")}),$(window).scroll(function(){d.css("top",Math.max(80,260-$(this).scrollTop()))}),$(window).resize(function(){e(),n>=1024?$("header nav").removeClass("shownav"):(s.removeClass("moveMain"),a.css("display","block").removeClass("fadeOut"),d.css("display","none"))})})</script><script>$(document).ready(function(){var c=$(".article-content>iframe"),n=$(".article-content>embed"),o=($("#toc"),$("#toc.toc-aside")),e=$(".openaside"),i=$(".closeaside");c.length>0&&c.wrap('<div class="video-container" />'),n.length>0&&n.wrap('<div class="video-container" />'),i.click(function(){o.css("display","block").addClass("fadeIn")}),e.click(function(){o.css("display","none")}),$(window).scroll(function(){o.css("top",Math.max(140,320-$(this).scrollTop()))})})</script><script>var cnzz_protocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1255875151'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s23.cnzz.com/z_stat.php%3Fid%3D1255875151' type='text/javascript'%3E%3C/script%3E"))</script>